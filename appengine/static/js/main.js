"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),Main=function(){function t(){_classCallCheck(this,t),this.canvas=document.getElementById("main"),this.input=document.getElementById("input"),this.canvas.width=449,this.canvas.height=449,this.ctx=this.canvas.getContext("2d"),this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.onMouseUp.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.initialize()}return _createClass(t,[{key:"initialize",value:function(){this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(0,0,449,449),this.ctx.lineWidth=1,this.ctx.strokeRect(0,0,449,449),this.ctx.lineWidth=.05;for(var t=0;t<27;t++)this.ctx.beginPath(),this.ctx.moveTo(16*(t+1),0),this.ctx.lineTo(16*(t+1),449),this.ctx.closePath(),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,16*(t+1)),this.ctx.lineTo(449,16*(t+1)),this.ctx.closePath(),this.ctx.stroke();this.drawInput(),$("#output td").text("").removeClass("success")}},{key:"onMouseDown",value:function(t){this.canvas.style.cursor="default",this.drawing=!0,this.prev=this.getPosition(t.clientX,t.clientY)}},{key:"onMouseUp",value:function(){this.drawing=!1,this.drawInput()}},{key:"onMouseMove",value:function(t){if(this.drawing){var e=this.getPosition(t.clientX,t.clientY);this.ctx.lineWidth=16,this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(this.prev.x,this.prev.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke(),this.ctx.closePath(),this.prev=e}}},{key:"getPosition",value:function(t,e){var i=this.canvas.getBoundingClientRect();return{x:t-i.left,y:e-i.top}}},{key:"drawInput",value:function(){var t=this.input.getContext("2d"),e=new Image;e.onload=function(){var i=[],n=document.createElement("canvas").getContext("2d");n.drawImage(e,0,0,e.width,e.height,0,0,28,28);for(var s=n.getImageData(0,0,28,28).data,a=0;a<28;a++)for(var o=0;o<28;o++){var c=4*(28*a+o);i[28*a+o]=(s[c+0]+s[c+1]+s[c+2])/3,t.fillStyle="rgb("+[s[c+0],s[c+1],s[c+2]].join(",")+")",t.fillRect(5*o,5*a,5,5)}255!==Math.min.apply(Math,i)&&$.ajax({url:"/api/mnist",method:"POST",contentType:"application/json",data:JSON.stringify(i),success:function(t){for(var e=0;e<2;e++){for(var i=0,n=0,s=0;s<10;s++){var a=Math.round(1e3*t.results[e][s]);a>i&&(i=a,n=s);for(var o=String(a).length,c=0;c<3-o;c++)a="0"+a;var r="0."+a;a>999&&(r="1.000"),$("#output tr").eq(s+1).find("td").eq(e).text(r)}for(var s=0;s<10;s++)s===n?$("#output tr").eq(s+1).find("td").eq(e).addClass("success"):$("#output tr").eq(s+1).find("td").eq(e).removeClass("success")}}})},e.src=this.canvas.toDataURL()}}]),t}();$(function(){var t=new Main;$("#clear").click(function(){t.initialize()})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJwcm90b3R5cGUiLCJNYWluIiwidGhpcyIsImNhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbnB1dCIsIndpZHRoIiwiaGVpZ2h0IiwiY3R4IiwiZ2V0Q29udGV4dCIsImFkZEV2ZW50TGlzdGVuZXIiLCJvbk1vdXNlRG93biIsImJpbmQiLCJvbk1vdXNlVXAiLCJvbk1vdXNlTW92ZSIsImluaXRpYWxpemUiLCJ2YWx1ZSIsImZpbGxTdHlsZSIsImZpbGxSZWN0IiwibGluZVdpZHRoIiwic3Ryb2tlUmVjdCIsImJlZ2luUGF0aCIsIm1vdmVUbyIsImxpbmVUbyIsImNsb3NlUGF0aCIsInN0cm9rZSIsImRyYXdJbnB1dCIsIiQiLCJ0ZXh0IiwicmVtb3ZlQ2xhc3MiLCJlIiwic3R5bGUiLCJjdXJzb3IiLCJkcmF3aW5nIiwicHJldiIsImdldFBvc2l0aW9uIiwiY2xpZW50WCIsImNsaWVudFkiLCJjdXJyIiwibGluZUNhcCIsIngiLCJ5IiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImxlZnQiLCJ0b3AiLCJpbWciLCJJbWFnZSIsIm9ubG9hZCIsImlucHV0cyIsInNtYWxsIiwiY3JlYXRlRWxlbWVudCIsImRyYXdJbWFnZSIsImRhdGEiLCJnZXRJbWFnZURhdGEiLCJqIiwibiIsImpvaW4iLCJNYXRoIiwibWluIiwiYXBwbHkiLCJhamF4IiwidXJsIiwibWV0aG9kIiwiY29udGVudFR5cGUiLCJKU09OIiwic3RyaW5naWZ5Iiwic3VjY2VzcyIsIm1heCIsIm1heF9pbmRleCIsInJvdW5kIiwicmVzdWx0cyIsImRpZ2l0cyIsIlN0cmluZyIsImsiLCJlcSIsImZpbmQiLCJhZGRDbGFzcyIsInNyYyIsInRvRGF0YVVSTCIsIm1haW4iLCJjbGljayJdLCJtYXBwaW5ncyI6IkFBQUEsWUFJQSxTQUFTQSxpQkFBZ0JDLEVBQVVDLEdBQWUsS0FBTUQsWUFBb0JDLElBQWdCLEtBQU0sSUFBSUMsV0FBVSxxQ0FGaEgsR0FBSUMsY0FBZSxXQUFjLFFBQVNDLEdBQWlCQyxFQUFRQyxHQUFTLElBQUssR0FBSUMsR0FBSSxFQUFHQSxFQUFJRCxFQUFNRSxPQUFRRCxJQUFLLENBQUUsR0FBSUUsR0FBYUgsRUFBTUMsRUFBSUUsR0FBV0MsV0FBYUQsRUFBV0MsYUFBYyxFQUFPRCxFQUFXRSxjQUFlLEVBQVUsU0FBV0YsS0FBWUEsRUFBV0csVUFBVyxHQUFNQyxPQUFPQyxlQUFlVCxFQUFRSSxFQUFXTSxJQUFLTixJQUFpQixNQUFPLFVBQVVSLEVBQWFlLEVBQVlDLEdBQWlKLE1BQTlIRCxJQUFZWixFQUFpQkgsRUFBWWlCLFVBQVdGLEdBQWlCQyxHQUFhYixFQUFpQkgsRUFBYWdCLEdBQXFCaEIsTUFLNWhCa0IsS0FBTyxXQUNQLFFBQVNBLEtBQ0xwQixnQkFBZ0JxQixLQUFNRCxHQUV0QkMsS0FBS0MsT0FBU0MsU0FBU0MsZUFBZSxRQUN0Q0gsS0FBS0ksTUFBUUYsU0FBU0MsZUFBZSxTQUNyQ0gsS0FBS0MsT0FBT0ksTUFBUSxJQUNwQkwsS0FBS0MsT0FBT0ssT0FBUyxJQUNyQk4sS0FBS08sSUFBTVAsS0FBS0MsT0FBT08sV0FBVyxNQUNsQ1IsS0FBS0MsT0FBT1EsaUJBQWlCLFlBQWFULEtBQUtVLFlBQVlDLEtBQUtYLE9BQ2hFQSxLQUFLQyxPQUFPUSxpQkFBaUIsVUFBV1QsS0FBS1ksVUFBVUQsS0FBS1gsT0FDNURBLEtBQUtDLE9BQU9RLGlCQUFpQixZQUFhVCxLQUFLYSxZQUFZRixLQUFL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QUFLakUiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0oKTtcblxuZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpOyB9IH1cblxuLypnbG9iYWwgJCovXG52YXIgTWFpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNYWluKCkge1xuICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTWFpbik7XG5cbiAgICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpO1xuICAgICAgICB0aGlzLmlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lucHV0Jyk7XG4gICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gNDQ5OyAvLyAxNiAqIDI4ICsgMVxuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSA0NDk7IC8vIDE2ICogMjggKyAxXG4gICAgICAgIHRoaXMuY3R4ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgdGhpcy5vbk1vdXNlRG93bi5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMub25Nb3VzZVVwLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLm9uTW91c2VNb3ZlLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmluaXRpYWxpemUoKTtcbiAgICB9XG5cbiAgICBfY3JlYXRlQ2xhc3MoTWFpbiwgW3tcbiAgICAgICAga2V5OiAnaW5pdGlhbGl6ZScsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0aWFsaXplKCkge1xuICAgICAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gJyNGRkZGRkYnO1xuICAgICAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QoMCwgMCwgNDQ5LCA0NDkpO1xuICAgICAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gMTtcbiAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZVJlY3QoMCwgMCwgNDQ5LCA0NDkpO1xuICAgICAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoID0gMC4wNTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjc7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4Lm1vdmVUbygoaSArIDEpICogMTYsIDApO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVUbygoaSArIDEpICogMTYsIDQ0OSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHguY2xvc2VQYXRoKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5tb3ZlVG8oMCwgKGkgKyAxKSAqIDE2KTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oNDQ5LCAoaSArIDEpICogMTYpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5kcmF3SW5wdXQoKTtcbiAgICAgICAgICAgICQoJyNvdXRwdXQgdGQnKS50ZXh0KCcnKS5yZW1vdmVDbGFzcygnc3VjY2VzcycpO1xuICAgICAgICB9XG4gICAgfSwge1xuICAgICAgICBrZXk6ICdvbk1vdXNlRG93bicsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbk1vdXNlRG93bihlKSB7XG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7XG4gICAgICAgICAgICB0aGlzLmRyYXdpbmcgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5wcmV2ID0gdGhpcy5nZXRQb3NpdGlvbihlLmNsaWVudFgsIGUuY2xpZW50WSk7XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ29uTW91c2VVcCcsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBvbk1vdXNlVXAoKSB7XG4gICAgICAgICAgICB0aGlzLmRyYXdpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuZHJhd0lucHV0KCk7XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ29uTW91c2VNb3ZlJyxcbiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIG9uTW91c2VNb3ZlKGUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRyYXdpbmcpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3VyciA9IHRoaXMuZ2V0UG9zaXRpb24oZS5jbGllbnRYLCBlLmNsaWVudFkpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aCA9IDE2O1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVDYXAgPSAncm91bmQnO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4Lm1vdmVUbyh0aGlzLnByZXYueCwgdGhpcy5wcmV2LnkpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVUbyhjdXJyLngsIGN1cnIueSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jdHguY2xvc2VQYXRoKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wcmV2ID0gY3VycjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sIHtcbiAgICAgICAga2V5OiAnZ2V0UG9zaXRpb24nLFxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0UG9zaXRpb24oY2xpZW50WCwgY2xpZW50WSkge1xuICAgICAgICAgICAgdmFyIHJlY3QgPSB0aGlzLmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgeDogY2xpZW50WCAtIHJlY3QubGVmdCxcbiAgICAgICAgICAgICAgICB5OiBjbGllbnRZIC0gcmVjdC50b3BcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9LCB7XG4gICAgICAgIGtleTogJ2RyYXdJbnB1dCcsXG4gICAgICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3SW5wdXQoKSB7XG4gICAgICAgICAgICB2YXIgY3R4ID0gdGhpcy5pbnB1dC5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgaW5wdXRzID0gW107XG4gICAgICAgICAgICAgICAgdmFyIHNtYWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJykuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgICAgICAgICBzbWFsbC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBpbWcud2lkdGgsIGltZy5oZWlnaHQsIDAsIDAsIDI4LCAyOCk7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBzbWFsbC5nZXRJbWFnZURhdGEoMCwgMCwgMjgsIDI4KS5kYXRhO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IDI4OyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuID0gNCAqIChpICogMjggKyBqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0c1tpICogMjggKyBqXSA9IChkYXRhW24gKyAwXSArIGRhdGFbbiArIDFdICsgZGF0YVtuICsgMl0pIC8gMztcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiKCcgKyBbZGF0YVtuICsgMF0sIGRhdGFbbiArIDFdLCBkYXRhW24gKyAyXV0uam9pbignLCcpICsgJyknO1xuICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KGogKiA1LCBpICogNSwgNSwgNSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKE1hdGgubWluLmFwcGx5KE1hdGgsIGlucHV0cykgPT09IDI1NSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9hcGkvbW5pc3QnLFxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoaW5wdXRzKSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gc3VjY2VzcyhkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXhfaW5kZXggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBNYXRoLnJvdW5kKGRhdGEucmVzdWx0c1tpXVtqXSAqIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiBtYXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF4X2luZGV4ID0gajtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlnaXRzID0gU3RyaW5nKHZhbHVlKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgMyAtIGRpZ2l0czsgaysrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICcwJyArIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gJzAuJyArIHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPiA5OTkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSAnMS4wMDAnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNvdXRwdXQgdHInKS5lcShqICsgMSkuZmluZCgndGQnKS5lcShpKS50ZXh0KHRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGogPT09IG1heF9pbmRleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI291dHB1dCB0cicpLmVxKGogKyAxKS5maW5kKCd0ZCcpLmVxKGkpLmFkZENsYXNzKCdzdWNjZXNzJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjb3V0cHV0IHRyJykuZXEoaiArIDEpLmZpbmQoJ3RkJykuZXEoaSkucmVtb3ZlQ2xhc3MoJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGltZy5zcmMgPSB0aGlzLmNhbnZhcy50b0RhdGFVUkwoKTtcbiAgICAgICAgfVxuICAgIH1dKTtcblxuICAgIHJldHVybiBNYWluO1xufSgpO1xuXG4kKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbWFpbiA9IG5ldyBNYWluKCk7XG4gICAgJCgnI2NsZWFyJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBtYWluLmluaXRpYWxpemUoKTtcbiAgICB9KTtcbn0pOyJdfQ==
